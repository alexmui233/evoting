<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="../css/result.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <!-- CSS only -->
    <style>

    </style>
</head>

<body>
    <%- include header %>
        <div style="height: 100vh;  width: 100%; background-color:#39ac37">

            <div style="background-color: white; width: 1000px; height: 100vh; margin: 0 auto;">
                <div class="rediv">
                    <h1 style="color: #39ac37;">Voting Result</h1>
                    <h2 class="">You can see the detail and result of vote event below</h2>
                </div>
                <div>
                    <form class="reform" action="" method="post">
                        <fieldset class="refieldset">
                            <div class="reformdiv" style="margin: 10px auto; display:inline;">
                                <p style=" margin: 0px; font-size: 22px;width: fit-content; float: left;">question: <%= event.question %></p>
                                <p style="float: right;  margin: 0px; font-size: 22px;"> voters: <%= totalans %><img src="../picture\people.svg" alt="" class="svgpic"></p>
                                <br><br>
                                <hr>
                            </div>
                            <% for (var i = 0; i < event.answers.length; i++){ %>
                                <div class="reformdiv" style="margin: 10px auto;">
                                    <label
                                        style="width: 550px; display: flex; justify-content: space-between;  margin: 10px auto; padding:0px">
                                        <span><%= event.answers[i] %></span>
                                        <span id="viewper"><%= per[i] %> %</span>
                                    </label>
                                    <div
                                        style=" display: flex; height: 1rem; overflow: hidden; line-height: 0; font-size: .75rem; background-color: #e9ecef; border-radius: 0.25rem;">
                                        <div class="resultbar" id="resultbar" <% /* eslint-disable css-propertyvalueexpected */ %> style="width: <%= per[i] %>%;"></div>
                                    </div>
                                    <br>
                                </div>
                            <% } %>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
        <script>
            function move() {
                var allElems = document.querySelectorAll(".resultbar");
                var id = setInterval(frame, 10);
                var currentWidth = 0;
              
                function frame() {
                  for (var i = 0; i < allElems.length; i++) {
                    var elem = allElems[i];
                    var style = window.getComputedStyle(elem);
                    var per = style.getPropertyValue("width");
                    var perNum = parseFloat(per); // use parseFloat() instead of parseInt()
                    console.log("perNum:", perNum);
                    if (currentWidth >= perNum) {
                      clearInterval(id);
                    } else {
                      currentWidth++;
                      console.log("currentWidth:", currentWidth);
                      elem.style.width = currentWidth + "px";
                    }
                  }
                }
              }
            //move();
              
            function exmove() {
                var allelem = document.querySelectorAll(".resultbar");
                for (var i = 0; i < allelem.length; i++) {
                    //var elem = document.querySelector(".resultbar");
                    //var per = document.querySelector(".resultbar").style.width;
                    var per = allelem[i].style.width;
                    var per_num = per.replace(/%/, "");
                    var width = 0;
                    var id = setInterval(frame, 10);
                    
                    function frame() {
                      console.log("per: ", per);
                      console.log("per_num: ", per_num);

                      if (width >= per_num) {
                        clearInterval(id);
                      } else {
                        width++;
                        allelem[i].style.width = width + "%";
                        console.log("allelem[", i, "].style.width: ", allelem[i].style.width);
                      }
                    }
                }  
            }
            //move()

            function myMove() {
                var elem = document.getElementById("resultbar");   
                var width = 0;
                var id = setInterval(frame, 10);
                function frame() {
                  if (width >= 50) {
                    clearInterval(id);
                  } else {
                    width++; 
                    elem.style.width = width + '%'; 
                  }
                }
              }
            //myMove()
        </script>
        <script src="../js/animationbar.js"></script>
</body>

</html>